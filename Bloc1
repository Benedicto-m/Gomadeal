Excellent ğŸ”¥
Tu prends **la bonne approche professionnelle** : repartir Ã  zÃ©ro mais en blocs quotidiens *complets et testables* â€” câ€™est exactement la mÃ©thode des Ã©quipes startup sÃ©rieuses (MVP â†’ sprint â†’ test â†’ itÃ©ration).

---

## ğŸ¯ Objectif

CrÃ©er **GomaDeal V2** â€” version propre, modulaire et testÃ©e bloc par bloc.

---

## âš™ï¸ MÃ‰THODOLOGIE DE DÃ‰VELOPPEMENT

On va travailler en **blocs journaliers (sprints)** :

* Chaque bloc = une *fonction complÃ¨te* (front + back + DB + test)
* Chaque bloc est **indÃ©pendant et fonctionnel seul**
* Ã€ la fin du bloc â†’ on valide en local avant dâ€™avancer

---

## ğŸ§± STRUCTURE GÃ‰NÃ‰RALE DU PROJET (finale)

Avant dâ€™entrer dans les blocs, voici la structure finale quâ€™on vise :

```
GomaDeal/
â”œâ”€â”€ manifest.json
â”œâ”€â”€ sw.js
â”œâ”€â”€ icons/
â”œâ”€â”€ sql/
â”‚   â”œâ”€â”€ schema.sql
â”‚   â”œâ”€â”€ functions.sql
â”‚   â”œâ”€â”€ policies.sql
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ js/
â”‚   â”‚   â”œâ”€â”€ api.js
â”‚   â”‚   â””â”€â”€ (autres plus tard)
â”‚   â””â”€â”€ pages/
â”‚       â”œâ”€â”€ register.html
â”‚       â”œâ”€â”€ verify.html
â”‚       â”œâ”€â”€ market.html
â”‚       â”œâ”€â”€ chat.html
â”‚       â”œâ”€â”€ report.html
â”‚       â””â”€â”€ dashboard.html
```

---

## ğŸ“… PLANNING EN BLOCS JOURNALIERS (7 JOURS)

| Jour    | Bloc                    | Objectif principal                                                                                     | RÃ©sultat testable                                           |
| ------- | ----------------------- | ------------------------------------------------------------------------------------------------------ | ----------------------------------------------------------- |
| **1ï¸âƒ£** | Initialisation          | CrÃ©er base Supabase, setup local, table devices, fonction register_device, page Register fonctionnelle | Enregistrement dâ€™un appareil fonctionnel avec code GD-xxxxx |
| **2ï¸âƒ£** | VÃ©rification            | Page Verify.html + RPC de recherche (IMEI / Code), affichage infos                                     | Recherche et affichage dâ€™un appareil enregistrÃ©             |
| **3ï¸âƒ£** | Signalement (Report)    | Page Report + RPC `report_lost`, marquage dâ€™appareil comme â€œlostâ€                                      | Un appareil signalÃ© devient â€œperduâ€                         |
| **4ï¸âƒ£** | MarchÃ©                  | Page Market + table market_listings + upload image                                                     | Afficher les annonces en ligne                              |
| **5ï¸âƒ£** | Vente + SÃ©curitÃ©        | Formulaire Sell + vÃ©rification IMEI perdu                                                              | EmpÃªche de vendre un appareil perdu                         |
| **6ï¸âƒ£** | Chat                    | Table chat_messages + interface chat                                                                   | Communication en temps rÃ©el entre deux utilisateurs         |
| **7ï¸âƒ£** | Dashboard global + Auth | Interface centralisÃ©e (user/admin) + redirection                                                       | Dashboard complet avec stats et liens actifs                |

---

## ğŸš€ COMMENÃ‡ONS PAR LE **BLOC 1 â€” INITIALISATION (jour 1)**

> Ce bloc te donnera un projet **opÃ©rationnel dÃ¨s le premier jour** :
> tu pourras enregistrer un appareil et gÃ©nÃ©rer un code GomaDeal.

---

### ğŸ”¹ Ã‰tape 1 : CrÃ©er le projet Supabase

1. Va sur [https://supabase.com](https://supabase.com)
2. CrÃ©e un **nouveau projet**
3. Copie :

   * **Project URL**
   * **Anon Key**
4. Active RLS et crÃ©e un bucket â€œdevice-imagesâ€

---

### ğŸ”¹ Ã‰tape 2 : CrÃ©er le fichier SQL `schema.sql`

Colle ceci dans ton Ã©diteur SQL Supabase :

```sql
create extension if not exists "pgcrypto";

create sequence if not exists public.gd_seq;

create table if not exists public.devices (
  id uuid default gen_random_uuid() primary key,
  gomadeal_code text unique,
  imei text unique not null,
  brand text,
  model text,
  owner_contact text,
  image_path text,
  registered_paid boolean default false,
  status text default 'active',
  created_at timestamptz default now()
);
```

---

### ğŸ”¹ Ã‰tape 3 : Fonction `register_device()`

```sql
create or replace function public.next_gd_code()
returns text language plpgsql as $$
declare
  seq bigint;
begin
  create sequence if not exists public.gd_seq;
  seq := nextval('public.gd_seq');
  return 'GD-' || lpad(seq::text, 5, '0');
end;
$$;

create or replace function public.register_device(
  p_imei text,
  p_brand text,
  p_model text,
  p_owner_contact text,
  p_image_path text default null
)
returns table(id uuid, gomadeal_code text, created_at timestamptz)
language plpgsql
security definer as $$
declare
  v_id uuid;
  v_code text;
  v_created timestamptz;
begin
  if exists(select 1 from public.devices where imei = p_imei) then
    raise exception 'IMEI dÃ©jÃ  enregistrÃ©';
  end if;

  v_code := public.next_gd_code();

  insert into public.devices (gomadeal_code, imei, brand, model, owner_contact, image_path)
  values (v_code, p_imei, p_brand, p_model, p_owner_contact, p_image_path)
  returning id, created_at into v_id, v_created;

  return query select v_id, v_code, v_created;
end;
$$;

grant execute on function public.register_device(text, text, text, text, text) to anon;
```

---

### ğŸ”¹ Ã‰tape 4 : CrÃ©er `src/js/api.js`

```js
const SUPABASE_URL = "https://xxxx.supabase.co"; // ton URL
const SUPABASE_ANON_KEY = "xxxx"; // ta clÃ©

export const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

export async function registerDevice({ imei, brand, model, owner_contact, image_path }) {
  const { data, error } = await supabase.rpc('register_device', {
    p_imei: imei,
    p_brand: brand,
    p_model: model,
    p_owner_contact: owner_contact,
    p_image_path: image_path
  });
  if (error) throw error;
  return data[0];
}
```

---

### ğŸ”¹ Ã‰tape 5 : CrÃ©er la page `src/pages/register.html`

```html
<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Enregistrer un appareil â€” GomaDeal</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/dist/umd/supabase.min.js"></script>
</head>
<body class="bg-gray-50 min-h-screen p-6 flex items-center justify-center">
  <div class="max-w-md w-full bg-white p-6 rounded-lg shadow">
    <h1 class="text-2xl font-bold mb-4 text-center">ğŸ“± Enregistrer un appareil</h1>

    <form id="registerForm" class="space-y-3">
      <input id="imei" required placeholder="IMEI" class="w-full p-2 border rounded" />
      <input id="brand" placeholder="Marque" class="w-full p-2 border rounded" />
      <input id="model" placeholder="ModÃ¨le" class="w-full p-2 border rounded" />
      <input id="owner_contact" placeholder="Contact propriÃ©taire" class="w-full p-2 border rounded" />
      <button class="bg-blue-600 text-white w-full py-2 rounded">Enregistrer</button>
    </form>

    <div id="result" class="mt-4 hidden">
      <h2 class="font-semibold text-lg mb-2">âœ… Enregistrement rÃ©ussi</h2>
      <p>Code GomaDeal : <span id="gdcode" class="font-mono text-blue-600"></span></p>
    </div>
  </div>

  <script type="module">
    import { registerDevice } from '/src/js/api.js';

    const form = document.getElementById('registerForm');
    const result = document.getElementById('result');
    const gdcodeEl = document.getElementById('gdcode');

    form.addEventListener('submit', async (e) => {
      e.preventDefault();
      try {
        const data = {
          imei: imei.value,
          brand: brand.value,
          model: model.value,
          owner_contact: owner_contact.value
        };
        const device = await registerDevice(data);
        gdcodeEl.textContent = device.gomadeal_code;
        result.classList.remove('hidden');
        form.reset();
      } catch (err) {
        alert(err.message);
      }
    });
  </script>
</body>
</html>
```

---

### ğŸ”¹ Ã‰tape 6 : Test

1. Lance un serveur local (`npx serve` ou `live-server`)
2. Ouvre [http://localhost:3000/src/pages/register.html](http://localhost:3000/src/pages/register.html)
3. Remplis le formulaire â†’ clique â€œEnregistrerâ€
4. âœ… Tu devrais voir un code **GD-00001**

---

### âœ… RÃ©sultat final du jour 1

Tu disposes :

* dâ€™un backend SQL fonctionnel
* dâ€™une fonction `register_device()` qui marche
* dâ€™une page HTML propre
* dâ€™un JS simple et clair
* dâ€™un test en local valide

---

Souhaites-tu que demain (bloc 2ï¸âƒ£) on parte sur la **page Verify** (recherche IMEI / code + affichage infos) ?
ğŸ‘‰ Ce sera le bloc 2, entiÃ¨rement prÃªt en une journÃ©e, avec test complet.
